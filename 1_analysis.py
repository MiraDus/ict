import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

st.set_page_config(page_title="–ê–Ω–∞–ª–∏–∑", layout="centered")
st.title("üìä –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–º –±–∏–ª–µ—Ç–∞–º")

st.markdown("‚úÖ –ó–¥–µ—Å—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø–æ–∏—Å–∫–∞ –±–∏–ª–µ—Ç–æ–≤.")

# üß© –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∑–∏–ª –¥–∞–Ω–Ω—ã–µ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
# üëâ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ: –º–æ–∂–Ω–æ –ø–æ–∑–≤–æ–ª–∏—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å CSV –≤—Ä—É—á–Ω—É—é
uploaded_file = st.file_uploader("üìé –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV-—Ñ–∞–π–ª —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –±–∏–ª–µ—Ç–æ–≤", type="csv")

if uploaded_file:
    df = pd.read_csv(uploaded_file)

    # ‚úÖ –ü—Ä–∏–≤–æ–¥–∏–º –¥–∞—Ç—É –∫ –Ω—É–∂–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É
    if "–î–∞—Ç–∞" in df.columns:
        df["–î–∞—Ç–∞"] = pd.to_datetime(df["–î–∞—Ç–∞"])

    # 1. üìà –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ –¥–∞—Ç–µ
    st.markdown("### üìÖ –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ –¥–∞—Ç–µ –≤—ã–ª–µ—Ç–∞")
    fig1, ax1 = plt.subplots()
    df.groupby("–î–∞—Ç–∞")["–¶–µ–Ω–∞ (‚Ç∏)"].mean().plot(kind="line", marker="o", ax=ax1)
    ax1.set_ylabel("–¶–µ–Ω–∞ (‚Ç∏)")
    ax1.set_xlabel("–î–∞—Ç–∞")
    ax1.set_title("üìà –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ –¥–∞—Ç–µ")
    st.pyplot(fig1)

    # 2. ‚úàÔ∏è –ß–∞—Å—Ç–æ—Ç–∞ –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–π
    st.markdown("### ‚úàÔ∏è –ß–∞—Å—Ç–æ—Ç–∞ –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–π")
    fig2, ax2 = plt.subplots()
    df["–ê–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏—è"].value_counts().plot(kind="bar", color="skyblue", ax=ax2)
    ax2.set_ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Å–æ–≤")
    ax2.set_title("‚úàÔ∏è –ê–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–∏ –≤ –≤—ã–±–æ—Ä–∫–µ")
    st.pyplot(fig2)

    # 3. üîÅ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Å–∞–¥–æ–∫
    st.markdown("### üîÅ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Å–∞–¥–æ–∫")
    fig3, ax3 = plt.subplots()
    df["–ü–µ—Ä–µ—Å–∞–¥–æ–∫"].value_counts().sort_index().plot(kind="bar", color="orange", ax=ax3)
    ax3.set_ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ")
    ax3.set_title("üîÅ –ü–µ—Ä–µ—Å–∞–¥–∫–∏")
    st.pyplot(fig3)

    st.markdown("‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω.")
else:
    st.info("üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª CSV, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.")
